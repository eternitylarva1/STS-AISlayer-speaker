# 解说历史显示功能说明

## 📋 功能概述

解说历史显示功能允许玩家在游戏界面中查看最近的AI解说内容，帮助回顾游戏过程中的精彩解说。

## 🎯 如何启用解说历史

### 1. **配置设置**
在Mod配置面板中找到以下选项：
- ✅ **显示解说历史** (`showCommentaryHistory`)
  - 勾选：启用历史记录显示
  - 不勾选：隐藏历史记录显示

### 2. **显示位置**
解说历史会显示在游戏界面的**左下角**，位于当前解说内容的上方。

## 🖥️ 显示效果

### **历史记录界面**
```
┌─────────────────────────────────────┐
│ 解说历史记录:                        │
│ 1. 精彩的攻击！造成了大量伤害          │
│ 2. 明智的防御选择，有效减少了伤害      │
│ 3. 这张牌用得恰到好处！              │
│ 4. 怪物的攻击被成功格挡了             │
│ 5. 战斗局势正在发生变化...            │
│ ...                                 │
└─────────────────────────────────────┘
```

### **显示特性**
- 📊 **最多显示8条**：避免界面过于拥挤
- 🎨 **美观设计**：半透明背景，灰色边框
- 📝 **智能截断**：超长文本会自动截断并显示"..."
- 🔢 **编号显示**：每条记录都有序号，便于查看
- 🎯 **实时更新**：新解说会自动添加到列表顶部

## ⌨️ 快捷键操作

### **F1键** - 切换显示/隐藏
- 按一次：隐藏整个解说系统（包括历史记录）
- 再按一次：重新显示

### **F2键** - 清空历史记录
- 立即清空所有历史记录
- 同时清理解说缓存

### **F3键** - 重置解说系统
- 重置整个解说系统
- 清空所有队列和缓存

## 🔧 技术实现

### **历史记录管理**
```java
// 历史记录存储
private final ArrayList<String> commentaryHistory;
private final int maxHistorySize = 20; // 最多保存20条

// 添加新记录
private void addToHistory(String commentary) {
    commentaryHistory.add(0, commentary); // 添加到开头
    // 限制大小
    while (commentaryHistory.size() > maxHistorySize) {
        commentaryHistory.remove(commentaryHistory.size() - 1);
    }
}
```

### **渲染逻辑**
```java
// 根据配置决定是否显示
if (aislayer.panels.ConfigPanel.showCommentaryHistory) {
    renderHistory(sb);
}
```

### **战斗处理**
```java
// 战斗开始时的处理
if (!ConfigPanel.showCommentaryHistory) {
    commentaryDisplay.clearHistory(); // 不保留历史则清空
}
```

## 📊 配置选项详解

### **显示解说历史** (`showCommentaryHistory`)

| 设置 | 效果 | 适用场景 |
|------|------|----------|
| ✅ 勾选 | 显示历史记录 | 想要回顾解说内容 |
| ❌ 不勾选 | 隐藏历史记录 | 保持界面简洁 |

### **性能影响**
- **启用时**：轻微增加渲染开销，几乎不影响性能
- **禁用时**：完全不渲染历史记录，性能最优

## 🎮 使用建议

### **推荐配置**
- **普通玩家**：启用历史记录，便于回顾精彩瞬间
- **性能敏感**：禁用历史记录，获得最佳性能
- **录制/直播**：启用历史记录，观众可以看到解说回顾

### **最佳实践**
1. **定期清理**：使用F2键定期清理历史记录
2. **战斗回顾**：战斗结束后查看历史记录总结
3. **学习分析**：通过历史记录分析游戏策略

## 🔍 故障排除

### **历史记录不显示**
1. 检查配置中是否启用了"显示解说历史"
2. 按F1键确保解说系统处于显示状态
3. 检查是否有解说内容生成

### **历史记录过多**
1. 使用F2键清空历史记录
2. 系统会自动限制最多保存20条记录
3. 可以在配置中禁用历史记录显示

### **显示位置异常**
1. 重启游戏重新初始化UI
2. 检查游戏分辨率设置
3. 使用F3键重置整个解说系统

## 📈 统计信息

在调试模式下按F4键可以查看：
- 解说队列状态
- 历史记录数量
- 当前解说状态
- 系统运行统计

---

现在解说历史功能已经完全可用了！在配置中启用"显示解说历史"后，你就能在游戏左下角看到最近的解说内容了。使用F1-F3快捷键可以方便地控制显示状态。