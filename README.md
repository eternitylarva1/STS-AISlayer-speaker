# AI爬塔 - 增强版

## 简介

这是一个《杀戮尖塔》游戏的Mod，允许你调用大模型的API来控制角色，并提供AI解说功能。

## 新功能特性

### 🎙️ AI解说系统增强
- **怪物介绍功能**：战斗开始时自动介绍怪物信息，替代原来的"让俺寻思寻思"
- **解说模式切换**：支持按牌数解说或回合结束解说两种模式
- **解说频率控制**：可自定义每几张牌触发一次解说
- **战斗状态跟踪**：实时跟踪战斗状态，提供更丰富的解说内容

### ⚙️ 配置选项
- **解说模式**：0=按牌数解说，1=回合结束解说
- **每几张牌解说一次**：控制按牌数模式的触发频率
- **战斗开始时介绍怪物**：是否在战斗开始时介绍怪物
- **怪物介绍详细程度**：0=简单介绍，1=详细介绍

### 🌍 多语言支持
- 完整的中文和英文界面支持
- 本地化的解说文本模板

### 🔧 性能优化
- 异步API调用，避免阻塞游戏主线程
- 智能缓存机制，减少重复API调用
- 可配置的超时和重试机制

## 安装说明

1. 确保已安装ModTheSpire框架
2. 将JAR文件复制到Steam游戏目录的mods文件夹
3. 启动游戏，在Mod配置中设置API密钥和URL
4. 根据需要调整解说相关配置

## 配置说明

### API配置
- 支持OpenAI兼容格式的API
- 可配置两个不同的AI平台
- 支持自定义模型名称

### 解说配置
- 启用/禁用AI解说
- 调整解说频率和风格
- 设置解说显示选项

## 使用指南

### 基础使用
1. 启动游戏开始新run
2. 进入战斗时会自动触发怪物介绍（如果启用）
3. 根据配置的解说模式，AI会在适当时机进行解说
4. 可以随时在配置中调整解说设置

### 高级功能
- 查看解说历史记录
- 调整API调用超时时间
- 自定义解说文本模板

## 技术架构

### 核心组件
- **AISlayer.java**：核心类，处理游戏状态信息收集
- **AIUtils.java**：AI工具类，处理API调用和游戏动作执行
- **CommentaryUtils.java**：解说工具类，专门处理AI解说功能
- **BattleStateTracker.java**：战斗状态跟踪器
- **TurnData.java**：回合数据记录类

### Patch系统
- 使用SpirePatch框架修改游戏原版行为
- 监听游戏事件，触发相应的解说逻辑
- 支持多种游戏场景的解说

## 限制以及提醒

- AI解说需要网络连接和有效的API密钥
- 当前版本专注于解说功能，AI自动控制功能有限
- 建议在稳定的网络环境下使用
- 首次使用可能需要加载时间

## 故障排除

### 常见问题
1. **解说不显示**：检查API配置和网络连接
2. **解说延迟**：调整超时设置或检查网络状况
3. **配置不生效**：重启游戏使配置生效

### 日志查看
- 游戏日志中包含详细的解说系统信息
- 可通过日志排查API调用和配置问题

## 开发说明

### 代码结构
```
src/main/java/aislayer/
├── AISlayer.java              # 核心类
├── utils/                     # 工具类
│   ├── AIUtils.java          # AI工具类
│   ├── CommentaryUtils.java  # 解说工具类
│   ├── BattleStateTracker.java # 战斗状态跟踪
│   └── TurnData.java         # 回合数据
├── patchs/                    # 游戏Hook
├── panels/                    # 配置界面
└── actions/                   # 游戏动作
```

### 扩展开发
- 支持添加新的解说触发条件
- 可扩展AI提示词模板
- 支持自定义解说风格

## 版本历史

### v2.0.0 (当前版本)
- ✨ 新增怪物介绍功能
- ✨ 新增解说模式切换
- ✨ 新增解说频率控制
- ✨ 新增战斗状态跟踪
- 🌍 完善多语言支持
- ⚡ 性能优化和稳定性改进

### v1.0.0 (原始版本)
- 基础AI控制功能
- 简单的解说系统

## 贡献指南

欢迎提交Issue和Pull Request来改进这个Mod！

## 结语

这个Mod在原有基础上进行了大幅增强，专注于提供更好的AI解说体验。如果你在使用过程中遇到问题或有改进建议，欢迎反馈。

希望这个增强版的AI爬塔Mod能给你带来更好的游戏体验！

## 许可证

本项目采用开源许可证，欢迎自由使用和修改。